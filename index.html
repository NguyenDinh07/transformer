<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="/assets/css/style.css">
    <link rel="stylesheet" href="/assets/fonts/themify-icons/themify-icons.css">
    <link rel="stylesheet" href="/assets/fonts/fontawesome-free-6.4.0-web/css/all.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
</head>

<body onload="xSpeech.populateVoiceList()">
    <div id="main">
        <div id="header">
            
        </div>

        <div id="slider">
            <div class="wrapper-background">
                
            </div>
            <div class="app--wrapper">
                <div class="wrapper-button-container">
                    <button type="button" class="wrapper-button" data-bs-toggle="modal" data-bs-target="#settingModal">
                        <span class="wrapper-icon ti-settings"></span>
                        Setting
                    </button>
        
                    <button type="button" class="wrapper-button not-first-btn" data-bs-toggle="modal" data-bs-target="#GPTModal">
                        <span class="wrapper-icon">
                            <img class="img-gpt" src="./assets/img/icons8-chatgpt-24.png" alt="">
                        </span>
                        Chat GPT
                    </button>
                </div>
                <div class="modal fade" id="settingModal" tabindex="-1" aria-labelledby="exampleModalLabel"
                    aria-hidden="true">
                    <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable ">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">Setting</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <div>
                                    <label for="selectVoice" class="h5"><b>Voice</b></label>
                                    <select id="selectVoice" class="w3-input w3-light-grey"></select>
                                </div>
    
                                <div id="key-bindings-menu">
                                    <h2>Key Bindings</h2>
                                    <form>
                                        <label for="speechKey">Speech to Text: </label>
                                        <input type="text" id="speechKey" data-default-key="ArrowUp" maxlength="1">
                                        <br>
                                        <label for="voiceKey">Text to Speech: </label>
                                        <input type="text" id="voiceKey" data-default-key="ArrowDown" maxlength="1">
                                        <br>
                                        <label for="speechGPTKey">Ask ChatGPT: </label>
                                        <input type="text" id="speechGPTKey" data-default-key="ArrowLeft" maxlength="1">
                                        <br> 
                                        <label for="voiceGPTKey">Open ChatGPT: </label>
                                        <input type="text" id="voiceGPTKey" data-default-key="ArrowRight" maxlength="1">
                                        <br>
                                        <label for="audioGPTKey">ChatGPT Answer Audio:</label>
                                        <input type="text" id="audioGPTKey" data-default-key="ArrowRight" maxlength="1">
                                    </form>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                <button type="button" class="btn btn-primary" id="save-btn">Save changes</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="app--wrapper__Text-to-Speech">
                    <div class="text-to-speech__header">
                        <h2 class="">Text to Speech
                            <span class="text-to-speech__header-icon ti-text"></span>
                            <span id="book" class="text-to-speech__header-icon ti-book text-to-speech__header-story">
                                <div class="dropdown">
                                    <div id="myDropdown" class="dropdown-content">
                                        <input type="text" id="fakeInput">
                                        <a value="New Divide">New Divide</a>
                                        <a value="Burn it down">Burn it down</a>
                                        <a value="In my remains">In my remains</a>
                                    </div>
                                </div>

                                <!-- <select name="" id="text-to-speech__header-story-list">
                                    <option class="text-to-speech__header-story-listItem" value="New Divide">New Divide
                                    </option>
                                    <option class="text-to-speech__header-story-listItem" value="Burn it down">Burn it
                                        down</option>
                                    <option class="text-to-speech__header-story-listItem" value="In my remains">In my
                                        remains</option>
                                </select> -->
                                <div class="btn-features story-feature">
                                    <p class="btn-features_content">
                                        Nghe truyện
                                    </p>
                                </div>
                            </span>
                        </h2>
                    </div>
                    <div class="text-to-speech__main">
                        <textarea placeholder="Nhập văn bản vào đây" name="" onblur="keybindMain()"
                            onfocus="removeKeyBind()" id="text-to-speech__input" cols="30" rows="10"></textarea>
                        <span class="text-to-speech_speaker">
                            <button id="speaker" class="text-to-speech_speaker-btn listen-btn play-btn active-btn">
                                <i class="playing fa-solid fa-circle-play font-weight400"></i>
                            </button>
                            <div class="btn-features listen-feature">
                                <p class="btn-features_content">
                                    Nghe văn bản
                                </p>
                            </div>
                            <button class="text-to-speech_speaker-btn not-first-btn active-btn copy-btn">
                                <i class="fa-solid fa-copy font-weight400"></i>
                            </button>
                            <div class="copy-features copy-feature">
                                <p class="btn-features_content">
                                    Copy văn bản
                                </p>
                            </div>
                        </span>
                    </div>
                </div>

                <div class="app--wrapper__Speech-to-Text">
                    <div class="speech-to-text__header">
                        <h2 class="">Speech to Text
                            <span class="text-to-speech__header-icon">
                                <i class="fa-solid fa-microphone"></i>
                            </span>
                        </h2>
                    </div>
                    <div class="speech-to-text__main">
                        <textarea name="" id="speech-to-text__input" class="speech-to-text__input" cols="30" rows="10"
                            placeholder="Bấm vào đây để nói..." ></textarea>
                        <!-- <input id="speech-to-text__input" type="text" class="speech-to-text__input" placeholder="Bấm vào đây để nói..."> -->
                        <span class="speech-to-text__buttons">
                            <button class="speech-to-text_copy-btn active-btn copy-btn">
                                <i class="fa-solid fa-copy font-weight400"></i>
                            </button>
                            <div class="copy-features copy-feature">
                                <p class="btn-features_content">
                                    Copy văn bản
                                </p>
                            </div>
                        </span>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="GPTModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-fullscreen">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">Chat GPT</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body" style="margin-top: 62px;;">
                        <div id="">
                            <div class="app--wrapper">
                                <div class="app--wrapper__Text-to-Speech">
                                    <div class="text-to-speech__header">
                                        <h2 class="">Text to Speech chatGPT
                                            <span class="text-to-speech__header-icon ti-text"></span>
                                        </h2>
                                    </div>
                                    <div class="text-to-speech__main">
                                        <textarea placeholder="Bạn hãy đặt câu hỏi?" name="" id="text-to-speech__input2"
                                            cols="30" rows="10" onblur="keybindMain()"
                                            onfocus="removeKeyBind()"></textarea>
                                        <span class="text-to-speech_speaker">
                                            <button id="speaker2"
                                                class="text-to-speech_speaker-btn listen-btn play-btn active-btn">
                                                <i class="playing fa-solid fa-circle-play font-weight400"></i>
                                            </button>
                                            <div class="btn-features listen-feature">
                                                <p class="btn-features_content">
                                                    Nghe văn bản
                                                </p>
                                            </div>
                                            <button
                                                class="text-to-speech_speaker-btn not-first-btn active-btn copy-btn">
                                                <i class="fa-solid fa-copy font-weight400"></i>
                                            </button>
                                            <div class="copy-features copy-feature">
                                                <p class="btn-features_content">
                                                    Copy văn bản
                                                </p>
                                            </div>
                                            <!-- <button class="text-to-speech_speaker-btn stop-btn">
                                            <i class="stopable fa-solid fa-circle-stop"></i>
                                            </button> -->
                                        </span>
                                    </div>
                                </div>

                                <div class="app--wrapper__Speech-to-Text">
                                    <div class="speech-to-text__header">
                                        <h2 class="">Speech to Text chatGPT
                                            <span class="text-to-speech__header-icon">
                                                <i class="fa-solid fa-microphone" id="voice-btn"></i>
                                            </span>
                                            <span class="text-to-speech__header-icon">
                                                <i class="fa-solid fa-volume-high" id="speaker-btn"></i>
                                            </span>
                                        </h2>
                                    </div>
                                    <div class="speech-to-text__main">
                                        <textarea name="" id="speech-to-text__output" class="speech-to-text__input"
                                            cols="30" rows="10" placeholder="Câu trả lời của bạn ở đây..."></textarea>
                                        <!-- <input id="speech-to-text__input" type="text" class="speech-to-text__input" placeholder="Bấm vào đây để nói..."> -->
                                        <span class="speech-to-text__buttons">
                                            <button class="speech-to-text_copy-btn active-btn copy-btn">
                                                <i class="fa-solid fa-copy font-weight400"></i>
                                            </button>
                                            <div class="copy-features copy-feature">
                                                <p class="btn-features_content">
                                                    Copy văn bản
                                                </p>
                                            </div>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-primary">Save changes</button>
                    </div> -->
                </div>
            </div>
        </div>

    </div>

    <script src="speech-to-text.js"></script>
    <script src="text-to-speech.js"></script>
    <script>
        var checkInput = 0;
        const bookIcon = document.getElementById('book')
        // const storyList = document.getElementById('text-to-speech__header-story-list');
        const storyList = document.getElementById('myDropdown')
        bookIcon.addEventListener('click', () => {
            storyList.style.display = 'block'
            document.getElementById('fakeInput').focus();
        })

        document.addEventListener('click', () => {
            if (!storyList.contains(event.target) && event.target !== bookIcon) {
                storyList.style.display = 'none'
            }
        })

        const keyBindings = {};

        function loadKeyBindings() {
            // Load key bindings from local storage if they exist, otherwise use default keys
            keyBindings["SpeechKey"] = localStorage.getItem("SpeechKey") || "Space";
            keyBindings["VoiceKey"] = localStorage.getItem("VoiceKey") || "AltLeft";
            keyBindings["SpeechGPTKey"] = localStorage.getItem("SpeechGPTKey") || "AltRight";
            keyBindings["VoiceGPTKey"] = localStorage.getItem("VoiceGPTKey") || "ControlLeft";
            keyBindings["AudioGPTKey"] = localStorage.getItem("AudioGPTKey") || "ControlRight";

            // Update input fields with current key bindings
            document.getElementById("speechKey").value = keyBindings["SpeechKey"];
            document.getElementById("voiceKey").value = keyBindings["VoiceKey"];
            document.getElementById("speechGPTKey").value = keyBindings["SpeechGPTKey"];
            document.getElementById("voiceGPTKey").value = keyBindings["VoiceGPTKey"];
            document.getElementById("audioGPTKey").value = keyBindings["AudioGPTKey"];
        }

        function saveKeyBindings() {
            // Save key bindings to local storage
            localStorage.setItem("SpeechKey", keyBindings["SpeechKey"]);
            localStorage.setItem("VoiceKey", keyBindings["VoiceKey"]);
            localStorage.setItem("SpeechGPTKey", keyBindings["SpeechGPTKey"]);
            localStorage.setItem("VoiceGPTKey", keyBindings["VoiceGPTKey"]);
            localStorage.setItem("AudioGPTKey", keyBindings["AudioGPTKey"]);

            console.log("Key bindings saved!");
        }

        function setKeyBinding(inputId, command) {
            const input = document.getElementById(inputId);
            input.value = "Press a key...";

            function handleKeyDown(event) {
                event.preventDefault();
                keyBindings[command] = event.code;
                input.value = event.code;
                document.removeEventListener("keydown", handleKeyDown);
            }

            document.addEventListener("keydown", handleKeyDown);
        }

        document.addEventListener("DOMContentLoaded", function () {
            loadKeyBindings();

            document.getElementById("speechKey").addEventListener("click", function () {
                setKeyBinding("speechKey", "SpeechKey");
            });

            document.getElementById("voiceKey").addEventListener("click", function () {
                setKeyBinding("voiceKey", "VoiceKey");
            });

            document.getElementById("speechGPTKey").addEventListener("click", function () {
                setKeyBinding("speechGPTKey", "SpeechGPTKey");
            });

            document.getElementById("voiceGPTKey").addEventListener("click", function () {
                setKeyBinding("voiceGPTKey", "VoiceGPTKey");
            });

            document.getElementById("audioGPTKey").addEventListener("click", function () {
                setKeyBinding("audioGPTKey", "AudioGPTKey");
            });

            document.getElementById("save-btn").addEventListener("click", function () {
                saveKeyBindings();
            });
        });

        function keybindMain() {
            document.addEventListener("keyup", keyBindFunc);
        }

        function removeKeyBind() {
            document.removeEventListener("keyup", keyBindFunc);
        }

        function keyBindFunc(event) {
            event.preventDefault();
            if (event.code === keyBindings["SpeechKey"]) {
                $('#GPTModal').modal('hide');
                speech_to_text_input();
            } else if (event.code === keyBindings["VoiceKey"]) {
                $('#GPTModal').modal('hide');
                text_to_speech_input();
            } else if (event.code === keyBindings["SpeechGPTKey"]) {
                $('#GPTModal').modal('show');
                voice_btn();
            } else if (event.code === keyBindings["VoiceGPTKey"]) {
                $('#GPTModal').modal('show');
                text_to_speech_input2();
            } else if (event.code === keyBindings["AudioGPTKey"]) {
                text_to_speech(getContent());
            }
        }

        document.getElementById("fakeInput").addEventListener("keydown", function (e) { CheckArrrow(e.keyCode); });
        var item = 0;			//global var holding current highlit item
        var firstItem = 0;
        function CheckArrrow(e) {
            div = document.getElementById("myDropdown");
            a = div.getElementsByTagName("a");
            item_original = item;

            if (e == 40) {	//Down arrow
                item++;
                if (firstItem == 0) {
                    item--;
                    firstItem++;
                }
                while (item < a.length && a[item].style.display == "none") {
                    item++;		//find next visible element
                }
                if (item >= a.length) {
                    item = item_original;
                }
                else {		//unhighlight old selection, highlight new selection
                    a[item_original].style.backgroundColor = "";
                    a[item].style.backgroundColor = "#ddd";
                    text_to_speech(a[item].innerText);
                }
            }
            if (e == 38) {	//Up arrow
                item--;
                while (item >= 0 && a[item].style.display == "none") {
                    item--;		//find next visible element
                }
                if (item < 0) {
                    item = item_original;
                }
                else {	//unhighlight old selection, highlight new selection
                    a[item_original].style.backgroundColor = "";
                    a[item].style.backgroundColor = "#ddd";
                    text_to_speech(a[item].innerText);
                }
            }
            if (e == 39) {	//Right key
                console.log("nanin")	//go to link
            }
        }

        keybindMain();

        function trash() {
            console.log("trash");
        }
    </script>
</body>

</html>